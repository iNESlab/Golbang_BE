# docker-compose.yml(ë¡œì»¬ìš©)

services:     # ì»¨í…Œì´ë„ˆ ì§€ì •

  web:
    container_name: web
    build: ./django  # . ì€ ë””í´íŠ¸ -> í”„ë¡œì íŠ¸ ë‚´ì˜ "Dockerfile"ì´ë¼ëŠ” ì´ë¦„ì„ ì•Œì•„ì„œ ì°¾ì•„ ë¹Œë“œí•´ì¤Œ
    restart: always
    volumes:  # íŒŒì¼ ì‹œìŠ¤í…œ ì •ì˜
      - ./django:/app
    ports:
      - "8000:8000"
    env_file: #
      - ./django/.env

  nginx:
    build: ./nginx
    restart: always
    environment:
      - SERVER_NAME=localhost
    ports:
      - "80:80"
    depends_on:
      - web

  db:
    container_name: db
    image: mariadb:latest
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_DB_PASSWORD}
      MYSQL_DATABASE: ${MYSQL_DB_NAME}
      MYSQL_USER: ${MYSQL_DB_USER}
      MYSQL_PASSWORD: ${MYSQL_DB_PASSWORD}
    ports:  # í¬íŠ¸í¬ì›Œë”© - ë¡œì»¬ì˜ í˜¸ìŠ¤íŠ¸ê°€ 3306í¬íŠ¸ë¥¼ ì‚¬ìš© ì¤‘ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ 3307 í¬íŠ¸ë¥¼ ë„ì»¤ ì»¨í…Œì´ë„ˆì˜ 3306 í¬íŠ¸ë¡œ í¬ì›Œë”©í•´ì¤Œ
      - "3307:3306"
    env_file: # ì„¤ì •ì€ .env íŒŒì¼ì— ì˜ì¡´
      - .env
    volumes:  # íŒŒì¼ ì‹œìŠ¤í…œ ì •ì˜
      - dbdata:/var/lib/mysql

  redis:
    container_name: redis
    image: redis:latest
    restart: always
    ports:
      - "6380:6379"
    environment:
      - REDIS_PASSWORD=${MYSQL_DB_PASSWORD}
    command: redis-server --requirepass ${MYSQL_DB_PASSWORD}
    volumes:
      - redisdata:/data

  celery:   # celery ì‘ì—…ì
    container_name: celery
    build: ./django
    command: celery -A golbang worker -l info
    volumes:
      - .:/app
    env_file:
      - .env

  celery-beat:   # ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸
    container_name: celery-beat
    build: ./django
    command: celery -A golbang beat -l info
    volumes:
      - .:/app
    env_file:
      - .env

  # ğŸš« ë¼ë””ì˜¤ ê¸°ëŠ¥ ë¹„í™œì„±í™” - ì•ˆë“œë¡œì´ë“œì—ì„œ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ
  # nginx-rtmp:   # ë¯¸ë””ì–´ ì„œë²„
  #   container_name: nginx-rtmp
  #   build: ./nginx
  #   restart: always
  #   ports:
  #     - "80:80"      # HTTP (HLS ì„œë¹™)
  #     - "1935:1935"  # RTMP (ìŠ¤íŠ¸ë¦¼ ì¸ì œìŠ¤íŠ¸)
  #   volumes:
  #     - ./nginx/hls:/var/hls              # HLS ì„¸ê·¸ë¨¼íŠ¸ ì €ì¥ì†Œ
  #     - ./django/static:/app/static       # Django ì •ì  íŒŒì¼
  #     - ./django/media:/app/media         # Django ë¯¸ë””ì–´ íŒŒì¼
  #   depends_on:
  #     - web
  #   networks:
  #     - default

volumes:
  dbdata:
  redisdata: